$(document).on("ready",(()=>{const e=$(".grid-user"),t=$(".grid-computer"),s=$(".grid-display"),r=$(".ship"),n=$(".destroyer-container"),a=$(".submarine-container"),o=$(".cruiser-container"),i=$(".battleship-container"),l=$(".carrier-container"),c=$("#start"),d=$("#replay-button"),u=$("#rotate"),h=$("#whose-go"),m=$("#info"),p=$("#setup-buttons"),g=[],f=[];let y=!0,b=!1,C="user";const k=10;let v=0,I=!1,E=!1,M=!1,Y=-1;const w=[{name:"destroyer",directions:[[0,1],[0,k]]},{name:"submarine",directions:[[0,1,2],[0,k,20]]},{name:"cruiser",directions:[[0,1,2],[0,k,20]]},{name:"battleship",directions:[[0,1,2,3],[0,k,20,30]]},{name:"carrier",directions:[[0,1,2,3,4],[0,k,20,30,40]]}];function x(e,t){for(let s=0;s<100;s++){const r=$("<div></div>");r.attr("data-id",s),e.append(r),t.push(r)}}function S(e){let t=Math.floor(Math.random()*e.directions.length),s=e.directions[t];0===t&&(direction=1),1===t&&(direction=10);let r=Math.abs(Math.floor(Math.random()*f.length-e.directions[0].length*direction));const n=s.some((e=>f[r+e].hasClass("taken"))),a=s.some((e=>(r+e)%k==9)),o=s.some((e=>(r+e)%k==0));n||a||o?S(e):s.forEach((t=>f[r+t].addClass("taken "+e.name)))}let G,P,W;function D(e){P=$(e.target),W=P.children().length}function N(e){e.preventDefault()}function O(e){e.preventDefault()}function U(){}function j(e){let t=P.children().last().attr("id"),r=t.slice(0,-2),n=parseInt(t.substr(-1)),a=n+parseInt($(e.target).attr("data-id"));let o=[0,10,20,30,40,50,60,70,80,90,1,11,21,31,41,51,61,71,81,91,2,22,32,42,52,62,72,82,92,3,13,23,33,43,53,63,73,83,93].splice(0,10*n),i=[99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60].splice(0,10*n);if(selectedShipIndex=parseInt(G.substr(-1)),a-=selectedShipIndex,console.log(a),y&&!o.includes(a))for(let t=0;t<W;t++){let s;0===t&&(s="start"),t===W-1&&(s="end"),g[parseInt($(e.target).attr("data-id"))-selectedShipIndex+t].addClass("taken horizontal "+s+" "+r)}else{if(y||i.includes(a))return;for(let t=0;t<W;t++){let s;0===t&&(s="start"),t===W-1&&(s="end"),g[parseInt($(e.target).attr("data-id"))-selectedShipIndex+k*t].addClass("taken vertical "+s+" "+r)}}P.remove(),0==s.find(".ship").length&&(M=!0)}function z(){}function T(e){p.css("display","none"),I||(e.emit("player-ready"),I=!0,q(v)),E&&("user"===C&&h.html("Your Go"),"enemy"===C&&h.html("Enemy's Go"))}function q(e){let t=`.p${parseInt(e)+1}`;$(`${t} .ready`).toggleClass("active")}function A(){b||("user"===C&&(h.html("Your Go"),f.forEach((e=>e.on("click",(function(t){Y=e.attr("data-id"),L(e.attr("class")?e.attr("class").split(/\s+/):[])}))))),"enemy"===C&&(h.html("Computers Go"),setTimeout(_,1e3)))}x(e,g),x(t,f),"singlePlayer"===gameMode?(S(w[0]),S(w[1]),S(w[2]),S(w[3]),S(w[4]),c.on("click",(()=>{p.css("display","none"),A()}))):function(){const e=io();function t(e){let t=`.p${parseInt(e)+1}`;$(`${t} .connected`).toggleClass("active"),parseInt(e)===v&&$(t).css("fontWeight","bold")}e.on("player-number",(t=>{-1===t?m.html("Sorry, server is full"):(v=parseInt(t),1===v&&(C="enemy"),console.log(v),e.emit("check-players"))})),e.on("player-connection",(e=>{console.log(`player ${e} has connected or disconnected`),t(e)})),e.on("enemy-ready",(t=>{E=!0,q(t),I&&(T(e),p.css("display","none"))})),e.on("check-players",(e=>{e.forEach(((e,s)=>{e.connected&&t(s),e.ready&&(q(s),s!==v&&(E=!0))}))})),e.on("timeout",(()=>{m.html("10min limit reached")})),c.on("click",(()=>{M?T(e):m.html("Please place all ships")})),f.forEach((t=>{t.on("click",(()=>{"user"===C&&I&&E&&(Y=t.attr("data-id"),e.emit("fire",Y))}))})),e.on("fire",(t=>{_(t);const s=g[t];var r=s.attr("class")?s.attr("class").split(/\s+/):[];e.emit("fire-reply",r),T(e)})),e.on("fire-reply",(t=>{L(t),T(e)}))}(),u.on("click",(function(){return y?(n.toggleClass("destroyer-container-vertical"),a.toggleClass("submarine-container-vertical"),o.toggleClass("cruiser-container-vertical"),i.toggleClass("battleship-container-vertical"),l.toggleClass("carrier-container-vertical"),void(y=!1)):y?void 0:(n.toggleClass("destroyer-container-vertical"),a.toggleClass("submarine-container-vertical"),o.toggleClass("cruiser-container-vertical"),i.toggleClass("battleship-container-vertical"),l.toggleClass("carrier-container-vertical"),void(y=!0))})),r.each((e=>$(this).on("dragstart",D))),g.forEach((e=>e.on("dragstart",D))),g.forEach((e=>e.on("dragover",N))),g.forEach((e=>e.on("dragenter",O))),g.forEach((e=>e.on("dragleave",U))),g.forEach((e=>e.on("drop",j))),g.forEach((e=>e.on("dragend",z))),r.each((e=>$(this).on("mousedown",(e=>{G=e.target.id}))));let B=0,F=0,H=0,J=0,K=0;function L(e){const s=t.find(`div[data-id='${Y}']`),r=Object.values(e);s.hasClass("boom")||"user"!==C||b||(r.includes("destroyer")&&B++,r.includes("submarine")&&F++,r.includes("cruiser")&&H++,r.includes("battleship")&&J++,r.includes("carrier")&&K++),r.includes("taken")?s.addClass("boom"):s.addClass("miss"),ee(),C="enemy","singlePlayer"===gameMode&&A()}let Q=0,R=0,V=0,X=0,Z=0;function _(e){if("singlePlayer"===gameMode&&(e=Math.floor(Math.random()*g.length)),g[e].hasClass("boom"))"singlePlayer"===gameMode&&_();else{const t=g[e].hasClass("taken");g[e].addClass(t?"boom":"miss"),g[e].hasClass("destroyer")&&Q++,g[e].hasClass("submarine")&&R++,g[e].hasClass("cruiser")&&V++,g[e].hasClass("battleship")&&X++,g[e].hasClass("carrier")&&Z++,ee()}C="user",h.html("Your Go")}function ee(){let e="computer";2===B&&(m.html("You sunk the computer's destroyer"),B=10),3===F&&(m.html("You sunk the computer's submarine"),F=10),3===H&&(m.html("You sunk the computer's cruiser"),H=10),4===J&&(m.html("You sunk the computer's battleship"),J=10),5===K&&(m.html("You sunk the computer's carrier"),K=10),2===Q&&(m.html("computer sunk your destroyer"),Q=10),3===R&&(m.html("computer sunk your submarine"),R=10),3===V&&(m.html("computer sunk your cruiser"),V=10),4===X&&(m.html("computer sunk your battleship"),X=10),5===Z&&(m.html("computer sunk your carrier"),Z=10),B+F+H+J+K===50&&(m.html("YOU WIN"),te()),Q+R+V+X+Z===50&&(m.html(`${e.toUpperCase()} WINS`),te(),d.css("display","inline"),d.on("click",(()=>{window.location.href="../index.html"})))}function te(){d.css("display","block"),d.on("click",(()=>{window.location.href="../index.html"})),b=!0,c.off("click",A)}}));